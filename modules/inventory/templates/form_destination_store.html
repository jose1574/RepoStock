{% extends 'base.html' %}

{% from 'macros/store_select_form.html' import store_select_form %}

{% block content %}
<section class="bg-gray-50 py-8">
	<div class="container mx-auto px-4">
		<div class="bg-white shadow-md rounded-lg p-6">
			<h2 class="text-lg font-semibold text-gray-800">Seleccionar Depósitos</h2>
			<p class="mt-2 text-gray-600">Selecciona el depósito origen y destino para crear la orden de recolección Automatica.</p>

			<form id="select-stores-form" action="{{ url_for('inventory.create_collection_order') }}" method="post" class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
				<div>
					<label for="store_origin" class="block text-sm font-medium text-gray-700">Depósito origen</label>
					<select id="store_origin" name="store_origin" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm">
						<option value="">-- Seleccionar depósito origen --</option>
						{% for s in stores %}
						<option value="{{ s.code }}">{{ s.description or s.name or s.code }}</option>
						{% endfor %}
					</select>
				</div>

				<div>
					<label for="store_destination" class="block text-sm font-medium text-gray-700">Depósito destino</label>
					<select id="store_destination" name="store_destination" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm">
						<option value="">-- Seleccionar depósito destino --</option>
						{% for s in stores %}
						<option value="{{ s.code }}">{{ s.description or s.name or s.code }}</option>
						{% endfor %}
					</select>
				</div>

				<div class="flex items-center">
					<button type="submit" class="w-full md:w-auto inline-flex items-center gap-2 bg-teal-600 hover:bg-teal-700 text-white text-sm font-medium py-2 px-4 rounded shadow">Aplicar</button>
				</div>
			</form>
		</div>
	</div>
</section>

<script>
	(function () {
		const form = document.getElementById('select-stores-form');
		if (!form) return;
		form.addEventListener('submit', function (e) {
			const o = document.getElementById('store_origin');
			const d = document.getElementById('store_destination');
			const origin = o ? (o.value || '').trim() : '';
			const dest = d ? (d.value || '').trim() : '';
			if (!origin || !dest) {
				e.preventDefault();
				alert('Selecciona depósito origen y destino.');
				return false;
			}
			if (origin === dest) {
				e.preventDefault();
				alert('El depósito origen y destino no pueden ser el mismo.');
				return false;
			}
			// Al usar method=GET los valores se pasan como parámetros en la URL
			return true;
		});
	})();
</script>
{% endblock %}